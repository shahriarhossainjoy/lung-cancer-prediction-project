# -*- coding: utf-8 -*-
"""survey_lung_cancer.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1R5WkS2wdoR43m9rDQLpXI4LgZ1vLjm2v
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

df=pd.read_csv("/content/survey lung cancer.csv")

df.shape

# viewing top 5 rows of Data
df.head()

# Viewing last 5 rows of Data
df.tail()

df.sample(10)

df[20:30]

df.iloc[100]

df.info()

df.dtypes

df.duplicated().sum()

df.drop_duplicates(inplace=True)

df.shape

df.duplicated().sum()

df.isnull().sum()

df['LUNG_CANCER'].value_counts()

df["LUNG_CANCER"].value_counts().plot(kind="bar", color= ["salmon", "lightblue"]);

df.describe()

df.head()

df['GENDER'].value_counts()

pd.crosstab(df.GENDER,df.LUNG_CANCER)

pd.crosstab(df.LUNG_CANCER,df.GENDER).plot(kind="bar", figsize=(10,6) , color=["salmon", "lightblue"]);
plt.title("Heart Disease Frequency according to sex")
plt.xlabel("0=No Heart Disease, 1=Heart Diease")
plt.ylabel("No of Persons")
plt.legend([ "Female","Male"])
plt.xticks(rotation=0)

from sklearn.preprocessing import LabelEncoder

# ১. জেন্ডার এনকোডিং (Label Encoding)
le = LabelEncoder()
df['GENDER'] = le.fit_transform(df['GENDER'])

# ২. টার্গেট ভেরিয়েবল (LUNG_CANCER) এনকোডিং
df['LUNG_CANCER'] = le.fit_transform(df['LUNG_CANCER'])

# ৩. বাকি কলামগুলো যেখানে 2 এবং 1 আছে, সেগুলোকে 1 এবং 0 তে পরিবর্তন করা
# নোট: AGE, GENDER এবং LUNG_CANCER বাদে বাকি সব কলামের নাম নিচ্ছি
columns_to_map = [
    'SMOKING', 'YELLOW_FINGERS', 'ANXIETY', 'PEER_PRESSURE',
    'CHRONIC DISEASE', 'FATIGUE ', 'ALLERGY ', 'WHEEZING',
    'ALCOHOL CONSUMING', 'COUGHING', 'SHORTNESS OF BREATH',
    'SWALLOWING DIFFICULTY', 'CHEST PAIN'
]

# 2 কে 1 এবং 1 কে 0 বানানোর জন্য
for col in columns_to_map:
    # আগে দেখে নিচ্ছি কলামটা আসলে ডেটাফ্রেমে আছে কি না (বানান ভুল এড়াতে)
    if col in df.columns:
        df[col] = df[col].apply(lambda x: 1 if x == 2 else 0)

# এনকোডিং শেষে ডেটা চেক করা
print(df.head())

df.corr()['LUNG_CANCER']

corr_matrix = df.corr()[['LUNG_CANCER']] # Convert Series to DataFrame
fig, ax =plt.subplots(figsize=(15,7))
ax = sns.heatmap(corr_matrix,annot=True);

df.head()

X=df.drop('LUNG_CANCER',axis=1)

y=df['LUNG_CANCER']

print(X.shape)
print(y.shape)

y.sample(5)

X.sample(5)

from sklearn.model_selection import train_test_split
X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)

X_train.shape

y_train.shape

X_test.shape

y_test.shape

from sklearn.linear_model import LogisticRegression

model=LogisticRegression()

model.fit(X_train,y_train)

model.score(X_train,y_train)

model.score(X_test,y_test)

y_pred=model.predict(X_test)

from sklearn.metrics import classification_report,confusion_matrix

confusion_matrix(y_test,y_pred )

print(classification_report(y_test,y_pred))

from sklearn.tree import DecisionTreeClassifier

model2=DecisionTreeClassifier()

model2.fit(X_train,y_train)

model2.score(X_train,y_train)

model2.score(X_test,y_test)

from sklearn.ensemble import RandomForestClassifier

model3=RandomForestClassifier()

model3.fit(X_train,y_train)

model3.score(X_train,y_train)

model3.score(X_test,y_test)

from sklearn.svm import SVC

model4=SVC()

model4.fit(X_train,y_train)

model4.score(X_train,y_train)

model4.score(X_test,y_test)

from sklearn.neighbors import KNeighborsClassifier

# মডেল তৈরি (ডিফল্ট n_neighbors=5 থাকে)
model5 = KNeighborsClassifier()

# মডেল ট্রেনিং
model5.fit(X_train, y_train)

# ট্রেনিং ডেটায় স্কোর দেখা
model5.score(X_train, y_train)

# টেস্ট ডেটায় স্কোর দেখা
model5.score(X_test, y_test)

from sklearn.ensemble import GradientBoostingClassifier

# মডেল তৈরি
model6 = GradientBoostingClassifier()

# মডেল ট্রেনিং
model6.fit(X_train, y_train)

# ট্রেনিং ডেটায় স্কোর দেখা
print(model6.score(X_train, y_train))

# টেস্ট ডেটায় স্কোর দেখা
print(model6.score(X_test, y_test))

# যদি ইন্সটল না থাকে তবে টার্মিনালে বা সেলে: !pip install xgboost
from xgboost import XGBClassifier

# মডেল তৈরি
model7 = XGBClassifier()

# মডেল ট্রেনিং
model7.fit(X_train, y_train)

# ট্রেনিং ডেটায় স্কোর দেখা
print(model7.score(X_train, y_train))

# টেস্ট ডেটায় স্কোর দেখা
print(model7.score(X_test, y_test))

# ফলাফল সংরক্ষণ করার জন্য একটি তালিকা
model_results = []

# ৭টি মডেলের একটি ডিকশনারি তৈরি করা হলো
# নোট: আপনি উপরে যেসব লাইব্রেরি ইমপোর্ট করেছেন, সেগুলোই এখানে ব্যবহার করা হচ্ছে
models_list = {
    "Logistic Regression": LogisticRegression(),
    "Decision Tree": DecisionTreeClassifier(),
    "Random Forest": RandomForestClassifier(),
    "SVC": SVC(),
    "KNN": KNeighborsClassifier(),
    "Gradient Boosting": GradientBoostingClassifier(),
    "XGBoost": XGBClassifier()
}

# লুপ চালিয়ে সব মডেলের স্কোর বের করা
for name, model in models_list.items():
    # মডেল ফিট বা ট্রেইন করা
    model.fit(X_train, y_train)

    # স্কোর বের করা
    train_acc = model.score(X_train, y_train)
    test_acc = model.score(X_test, y_test)

    # লিস্টে সংরক্ষণ করা
    model_results.append({
        "Model Name": name,
        "Train Score": round(train_acc, 4), # ৪ ঘর পর্যন্ত দশমিক রাখা
        "Test Score": round(test_acc, 4)
    })

# পান্ডাস ডেটাফ্রেম তৈরি করা যাতে টেবিলে দেখা যায়
comparison_df = pd.DataFrame(model_results)

# টেস্ট স্কোরের ভিত্তিতে বড় থেকে ছোট (Descending) সাজানো
comparison_df = comparison_df.sort_values(by='Test Score', ascending=False)

# টেবিলটি প্রিন্ট করা
print("=========== Model Comparison Table ===========")
print(comparison_df)

# চাইলে গ্রাফও দেখতে পারেন (অপশনাল)
comparison_df.plot(x="Model Name", y=["Train Score", "Test Score"], kind="bar", figsize=(12, 6))
plt.title("Train vs Test Score Comparison")
plt.ylabel("Accuracy")
plt.ylim(0.7, 1.0) # গ্রাফটি সুন্দর দেখানোর জন্য জুম করা হয়েছে
plt.show()

import joblib

joblib.dump(model,'survey_lung_cancer.joblib')